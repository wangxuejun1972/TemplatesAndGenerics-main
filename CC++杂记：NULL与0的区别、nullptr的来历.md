# C/C++杂记：NULL与0的区别、nullptr的来历



某些时候，我们需要将指针赋值为空指针，以防止野指针。

 

有人喜欢使用NULL作为空指针常量使用，例如：int* p = NULL;。

也有人直接使用0值作为空指针常量，例如：int* p = 0;。

 

前者可能觉得：NULL作为空指针常量，名字很形象，可读性较强。

后者可能觉得：NULL并不是C/C++语言的关键字，而是一个在标准库头文件<stddef.h>中定义的宏，因此要使用NULL，可能需要直接或简介地包含<stddef.h>头文件，比较麻烦。



## C++中null与0的区别

0是一个数字，本身有着一些原生的特性诸如：起始，没有，正负的分界线，0/1中的0还可以表示否定。 

NULL用于将指针指定为空指针，也就是说该指针不指向任何对象，不可以对该指针进行解引用，否则系统会报错。 

很巧合并且可能令人迷惑的是，在Windows环境下，NULL正好被定义为0，对于Windows程序，将指针初始化为0或NULL的作用是相同的，都使指针无效。这是因为Windows的内存管理将0x00000000地址设为无效内存，不允许代码对它进行读写。仅仅微软的一个定义，令不少人误以为NULL和0有着天生的紧密关系，这显然是一个历史的误区。 

既然设计NULL是为了满足将指针规定为无效的逻辑上的功能，那么假如某个系统指定无效内存地址为0x20000000，那么基于这个系统的编译器就很有可能将NULL定义为0x20000000，这时0和NULL就不能等同了。 

千万记住，0以及其他所有数字在编程中仅仅是一个常量，并不一定具有某一逻辑上的功能。

 

## 问题一：NULL与常数0值有何区别？

 

1) 如果gcc是c 语言模式而且gcc版本低于3.0，那么定义NULL 为 void* 类型

2) 如果gcc是c++ 语言模式，而且是32位，那么定义NULL 为无类型的0

3) 如果gcc是c++ 语言模式，而且是64位，那么定义NULL 为long long 类型的0

要弄清楚这个问题，我们采用问与答的形式来描述。

 

### 问：NULL到底是什么？

 

答：NULL是一个宏。

 

### 问：它的值是多少？

 

答：C/C++标准规定：它的值是一个空指针常量（null pointer constant），由实现定义。#1,#2

 

### 问：什么样的值才能称之为空指针常量？

 

答：C语言中常数0和(void*)0都是空指针常量；C++中（暂且忽略C++11）常数0是，而(void*)0 不是。#3,#4

 

### 问：NULL宏是在哪里定义的？

 

答：通常是在C标准库的<stddef.h>头文件中，不过别的头文件中可能也有定义。

 

### 问：一般编译器的<stddef.h>头文件中NULL宏是如何定义的？

 

答：以gcc或clang编译器为例，NULL的定义大致如下（稍有简化）：

```c++
#if defined(__cplusplus)
# define NULL 0    // C++中使用0作为NULL的值
#else
# define NULL ((void *)0)    // C中使用((void *)0)作为NULL的值
#endif
```

 

### 问：为什么C中(void*)0是空指针常量，而C++中不是？

 

答：因为C语言中任何类型的指针都可以（隐式地）转换为void*型，反过来也行，而C++中void*型不能隐式地转换为别的类型指针（例如：int*p = (void*)0;使用C++编译器编译会报错）。#5,#6

 

### 问：既然C/C++标准中，常数0都可作为空指针常量，为什么不统一使用0？

 

答：个人觉得由于(void*)0更能体现指针的意义，而常数0更多的时候是用作整数。因此，C语言中NULL定义选择了(void*)0。（仅供参考）

 

## 问题二：C++11中为什么要引入nullptr？

 

考虑着这样一个函数重载的情形：



```c++
#include <stddef.h>
void foo(int) {}     // #1
void foo(char*) {}   // #2
int main() {
    foo(NULL); // 调用#1还是#2？
}
```



 

从字面上来讲，NULL是个空指针常量，我们可能会觉得：既然是个指针，那么应该调用#2。但事实上调用的却是#1，因为C++中NULL扩展为常数0，它是int型。

 

根本原因就是：常数0既是整数常量，也是空指针常量。

 

为了解决这种二义性，C++11标准引入了关键字nullptr，它作为一种空指针常量。#7例如：

 

```c++
void foo(int) {}     // #1
void foo(char*) {}   // #2
int main() {
    foo(nullptr); // 它会毫无异议地调用#2
}
```